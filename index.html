<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Formulario Identifier – iD Myself – HOYALUX</title>
<style>
  :root{
    --hoya-navy:#0a2d6f;
    --hoya-blue:#0b3d91;
    --accent:#7a2b6c;
    --accent-bg:#f6e8f3;
    --grid:#e6e8f0;
    --ink:#0f172a;
    --muted:#475569;
  }

  /* Página */
  html,body{margin:0;background:#eef2ff;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  .sheet{width:210mm;min-height:297mm;margin:0 auto;background:#fff;box-shadow:0 8px 24px rgba(2,6,23,.15);padding:14mm 12mm 20mm}
  @media print{
    body{background:#fff}
    .toolbar{display:none!important}
    .sheet{box-shadow:none;margin:0;width:auto;min-height:auto;padding:0}
  }

  /* Botón fijo arriba */
  .toolbar{
    position:sticky;top:0;z-index:50;
    display:flex;justify-content:center;padding:12px;background:#0a2d6f;
    box-shadow:0 2px 6px rgba(2,6,23,.18)
  }
  .btn-main{
    background:#0a2d6f;color:#fff;border:2px solid #fff;
    padding:10px 18px;border-radius:10px;cursor:pointer;font-weight:700
  }
  .btn-main[disabled]{opacity:.5;cursor:not-allowed}

  /* Secciones */
  .section{margin:12px 0}
  .title{color:var(--accent);font-weight:800;margin:0 0 8px 0;letter-spacing:.3px}
  .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}

  .col-12{grid-column:span 12}
  .col-8{grid-column:span 8}
  .col-6{grid-column:span 6}
  .col-4{grid-column:span 4}
  .col-3{grid-column:span 3}
  .col-2{grid-column:span 2}

  label{font-size:12px;color:var(--muted);display:block;margin-bottom:3px}
  .input{
    width:100%;height:34px;border:1px solid var(--grid);border-radius:6px;
    padding:6px 10px;font:inherit;color:var(--ink);background:#fbfbfe
  }
  .input:focus{outline:none;border-color:var(--hoya-blue);box-shadow:0 0 0 2px #dbeafe}

  /* Azul de “Información personal” */
  .personal{
    background:#0b3d91;color:#e6eefc;border-radius:10px;padding:16px 16px 14px
  }
  .personal .title{color:#fff}
  .personal label{color:#e6eefc}
  .personal .input{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.5);color:#fff}
  .personal .input::placeholder{color:#dbe4ff}

  /* Chips (radios bonitos) */
  .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chips label{
    display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border:1px solid #e2e8f0;border-radius:999px;cursor:pointer;
    background:#fff;color:#0f172a;font-size:13px
  }
  .chips input{appearance:none;margin:0;width:0;height:0}
  .chips label:has(input:checked){
    background:var(--accent-bg);border-color:#e7cfe0;color:var(--accent)
  }
  /* separador “ó” automático entre 2 chips */
  .chips label+label::before{content:"ó";margin:0 2px;color:#64748b;font-weight:700}

  /* Línea divisoria */
  .hr{border:0;border-top:1px solid #f1f5f9;margin:14px 0}

  /* Subtítulos de columnas (OI/OD) */
  .subcap{font-weight:800;color:#7a2b6c;margin:4px 0 6px}

  /* Mini nota */
  .note{font-size:11px;color:#6b7280}

  /* Ajustes compactos del bloque PRISMA */
  .pr-grid{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:end}
</style>
</head>
<body>

  <!-- Botón único -->
  <div class="toolbar">
    <button id="btnSend" class="btn-main" type="button">Enviar a Google Sheets & Imprimir PDF</button>
  </div>

  <div class="sheet">
    <form id="formHoya" autocomplete="off">
      <!-- INFORMACIÓN PERSONAL (Azul) -->
      <div class="section personal">
        <h3 class="title">INFORMACIÓN PERSONAL</h3>
        <div class="row">
          <!-- OJO: etiqueta cambia, name se mantiene “sistema” para tu hoja -->
          <div class="col-6">
            <label>Nombre del cliente</label>
            <input class="input" name="sistema" placeholder="Escribe el nombre completo">
          </div>
          <div class="col-3">
            <label>Nombre</label>
            <input class="input" name="nombre">
          </div>
          <div class="col-3">
            <label>Apellidos</label>
            <input class="input" name="apellidos">
          </div>

          <div class="col-4">
            <label>Sexo</label>
            <div class="chips" role="group" aria-label="Sexo">
              <label><input type="radio" name="sexo" value="Masculino">Masculino</label>
              <label><input type="radio" name="sexo" value="Femenino">Femenino</label>
            </div>
          </div>
          <div class="col-8">
            <label>Fecha de nacimiento</label>
            <input class="input" name="fecha_nac" type="date" placeholder="dd/mm/aaaa">
          </div>
        </div>
      </div>

      <!-- PRESCRIPCIÓN -->
      <div class="section">
        <h3 class="title">PRESCRIPCIÓN</h3>

        <div class="row">
          <div class="col-6"><div class="subcap">Ojo izquierdo</div></div>
          <div class="col-6"><div class="subcap">Ojo derecho</div></div>

          <!-- OI: Esférico / Cilíndrico / Eje -->
          <div class="col-2"><label>Esférico</label><input class="input" name="esf_oi"></div>
          <div class="col-2"><label>Cilíndrico</label><input class="input" name="cil_oi"></div>
          <div class="col-2"><label>Eje</label><input class="input" name="eje_oi"></div>

          <!-- OD: Esférico / Cilíndrico / Eje -->
          <div class="col-2"><label>Esférico</label><input class="input" name="esf_od"></div>
          <div class="col-2"><label>Cilíndrico</label><input class="input" name="cil_od"></div>
          <div class="col-2"><label>Eje</label><input class="input" name="eje_od"></div>

          <!-- Adición OI / OD -->
          <div class="col-3"><label>Adición OI</label><input class="input" name="adic_oi"></div>
          <div class="col-3"><label>Adición OD</label><input class="input" name="adic_od"></div>

          <!-- Prisma OI y Primer par -->
          <div class="col-3">
            <label>Prisma OI</label>
            <div class="chips" role="group" aria-label="Prisma OI">
              <label><input type="radio" name="prisma_oi" value="Sí">Sí</label>
              <label><input type="radio" name="prisma_oi" value="No">No</label>
            </div>
          </div>
          <div class="col-3">
            <label>Primer par de lentes</label>
            <div class="chips" role="group" aria-label="Primer par">
              <label><input type="radio" name="primer_par" value="Sí">Sí</label>
              <label><input type="radio" name="primer_par" value="No">No</label>
            </div>
          </div>
        </div>
      </div>

      <!-- INFORMACIÓN DEL PRISMA (con chips corregidos) -->
      <div class="section">
        <h3 class="title">INFORMACIÓN DEL PRISMA</h3>

        <div class="row">
          <!-- Columna OI -->
          <div class="col-6">
            <div class="subcap">Ojo izquierdo</div>

            <!-- Horizontal OI -->
            <div class="pr-grid">
              <div>
                <label>Horizontal (valor)</label>
                <input class="input" name="prisma_h_oi_val" placeholder="mm">
              </div>
              <div class="chips" role="group" aria-label="Horizontal OI">
                <label><input type="radio" name="horiz_oi" value="Nasal">Nasal</label>
                <label><input type="radio" name="horiz_oi" value="Temporal">Temporal</label>
              </div>
            </div>

            <!-- Vertical OI -->
            <div class="pr-grid" style="margin-top:6px">
              <div>
                <label>Vertical (valor)</label>
                <input class="input" name="prisma_v_oi_val" placeholder="mm">
              </div>
              <div class="chips" role="group" aria-label="Vertical OI">
                <label><input type="radio" name="vert_oi" value="Nasal">Nasal</label>
                <label><input type="radio" name="vert_oi" value="Temporal">Temporal</label>
              </div>
            </div>

            <div style="margin-top:6px">
              <label>Resultado</label>
              <input class="input" name="prisma_res_oi">
            </div>
          </div>

          <!-- Columna OD -->
          <div class="col-6">
            <div class="subcap">Ojo derecho</div>

            <!-- Horizontal OD -->
            <div class="pr-grid">
              <div>
                <label>Horizontal (valor)</label>
                <input class="input" name="prisma_h_od_val" placeholder="mm">
              </div>
              <div class="chips" role="group" aria-label="Horizontal OD">
                <label><input type="radio" name="horiz_od" value="Nasal">Nasal</label>
                <label><input type="radio" name="horiz_od" value="Temporal">Temporal</label>
              </div>
            </div>

            <!-- Vertical OD -->
            <div class="pr-grid" style="margin-top:6px">
              <div>
                <label>Vertical (valor)</label>
                <input class="input" name="prisma_v_od_val" placeholder="mm">
              </div>
              <div class="chips" role="group" aria-label="Vertical OD">
                <label><input type="radio" name="vert_od" value="Nasal">Nasal</label>
                <label><input type="radio" name="vert_od" value="Temporal">Temporal</label>
              </div>
            </div>

            <div style="margin-top:6px">
              <label>Resultado</label>
              <input class="input" name="prisma_res_od">
            </div>
          </div>
        </div>
      </div>

      <hr class="hr">

      <!-- ESTILO DE VIDA -->
      <div class="section">
        <h3 class="title">ESTILO DE VIDA · ¿Dónde pasas el día?</h3>
        <div class="row">
          <div class="col-12"><label>Ambientes interiores</label></div>
          <div class="col-12 chips">
            <label><input type="radio" name="int" value="0%">0%</label>
            <label><input type="radio" name="int" value="10%">10%</label>
            <label><input type="radio" name="int" value="20%">20%</label>
            <label><input type="radio" name="int" value="30%">30%</label>
            <label><input type="radio" name="int" value="40%">40%</label>
            <label><input type="radio" name="int" value="50%">50%</label>
            <label><input type="radio" name="int" value="60%">60%</label>
            <label><input type="radio" name="int" value="70%">70%</label>
            <label><input type="radio" name="int" value="80%">80%</label>
            <label><input type="radio" name="int" value="90%">90%</label>
            <label><input type="radio" name="int" value="100%">100%</label>
          </div>

          <div class="col-12" style="margin-top:8px"><label>Ambientes exteriores</label></div>
          <div class="col-12 chips">
            <label><input type="radio" name="ext" value="0%">0%</label>
            <label><input type="radio" name="ext" value="10%">10%</label>
            <label><input type="radio" name="ext" value="20%">20%</label>
            <label><input type="radio" name="ext" value="30%">30%</label>
            <label><input type="radio" name="ext" value="40%">40%</label>
            <label><input type="radio" name="ext" value="50%">50%</label>
            <label><input type="radio" name="ext" value="60%">60%</label>
            <label><input type="radio" name="ext" value="70%">70%</label>
            <label><input type="radio" name="ext" value="80%">80%</label>
            <label><input type="radio" name="ext" value="90%">90%</label>
            <label><input type="radio" name="ext" value="100%">100%</label>
          </div>
        </div>

        <!-- Actividades 0..5 (solo radio; detalles los mantienes si ya los tenías en tu versión larga) -->
        <div class="row" style="margin-top:10px">
          <div class="col-12"><span class="note">* Para mantener este archivo compacto, dejé fuera la tabla de actividades y “GAFAS ANTERIORES / RECETA PREVIA / MEDIDAS DEL MARCO”. Si en tu versión ya estaban, puedes conservarlas tal cual —no afectan a este ajuste de los chips Nasal/Temporal ni al envío.</span></div>
        </div>
      </div>

      <hr class="hr">

      <!-- NIVEL DE SATISFACCIÓN -->
      <div class="section">
        <h3 class="title">NIVEL DE SATISFACCIÓN</h3>
        <div class="chips" role="group" aria-label="Satisfacción">
          <label><input type="radio" name="satisfaccion" value="Muy satisfecho">Muy satisfecho</label>
          <label><input type="radio" name="satisfaccion" value="Satisfecho">Satisfecho</label>
          <label><input type="radio" name="satisfaccion" value="Neutral">Neutral</label>
          <label><input type="radio" name="satisfaccion" value="Insatisfecho">Insatisfecho</label>
          <label><input type="radio" name="satisfaccion" value="Muy insatisfecho">Muy insatisfecho</label>
        </div>
      </div>
    </form>
  </div>

<script>
  // 👉 Reemplaza por tu URL de Apps Script si fuese necesario
  const GAS_URL = "https://script.google.com/macros/s/AKfycbz8wYVJCHIBZPW2mzkpBkSUdGUzddeNmXcgpZmeTOfHHgiL1WcA1CMHIM8G4CaG5iMGEQ/exec";

  const btn = document.getElementById('btnSend');
  const form = document.getElementById('formHoya');

  function getRadio(name){
    const el = form.querySelector(`input[name="${name}"]:checked`);
    return el ? el.value : "";
    }

  // Recolecta TODOS los campos del formulario como objeto plano
  function collectData(){
    const fd = new FormData(form);
    const data = {};
    for (const [k,v] of fd.entries()){
      // Si hay varias ocurrencias con el mismo nombre (p.e. detalles con checkboxes),
      // acumular en arreglo / csv
      if (data[k] !== undefined){
        if (Array.isArray(data[k])) data[k].push(v);
        else data[k] = [data[k], v];
      }else{
        data[k] = v;
      }
    }
    // Radios que no van en FormData por no haber sido marcados
    data["sexo"]            = getRadio("sexo")            || data["sexo"] || "";
    data["prisma_oi"]       = getRadio("prisma_oi")       || data["prisma_oi"] || "";
    data["primer_par"]      = getRadio("primer_par")      || data["primer_par"] || "";
    data["horiz_oi"]        = getRadio("horiz_oi")        || data["horiz_oi"] || "";
    data["vert_oi"]         = getRadio("vert_oi")         || data["vert_oi"] || "";
    data["horiz_od"]        = getRadio("horiz_od")        || data["horiz_od"] || "";
    data["vert_od"]         = getRadio("vert_od")         || data["vert_od"] || "";
    data["int"]             = getRadio("int")             || data["int"] || "";
    data["ext"]             = getRadio("ext")             || data["ext"] || "";
    data["satisfaccion"]    = getRadio("satisfaccion")    || data["satisfaccion"] || "";

    // Convierte arrays (si los hubiera) a lista “; ”
    for (const k in data){
      if (Array.isArray(data[k])) data[k] = data[k].join("; ");
    }
    // Timestamp en el cliente (Apps Script también puede agregarlo)
    data["timestamp"] = new Date().toLocaleString();
    return data;
  }

  async function handleSubmit(){
    try{
      btn.disabled = true; btn.textContent = "Enviando...";
      const payload = collectData();
      const res = await fetch(GAS_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      // Si todo ok, lanzar impresión
      btn.textContent = "Guardado. Abriendo impresión...";
      setTimeout(()=>{ window.print(); btn.textContent="Enviar a Google Sheets & Imprimir PDF"; btn.disabled=false; }, 350);
    }catch(err){
      alert("No se pudo enviar. Revisa tu conexión o la URL de Apps Script.");
      btn.textContent="Enviar a Google Sheets & Imprimir PDF";
      btn.disabled=false;
    }
  }

  btn.addEventListener("click", handleSubmit);
</script>
</body>
</html>
