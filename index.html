<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Formulario Identifier – iD Myself – HOYALUX (Plantilla idéntica)</title>
<style>
  /* ===== Tamaño A4 y reset impresión ===== */
  @page { size: A4; margin: 0; }
  html, body { height: 100%; }
  body{
    margin:0;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background:#eaf0ff;
  }

  /* ===== Hoja A4 con imagen de fondo ===== */
  .page{
    width: 210mm;
    height: 297mm;
    margin: 10mm auto;   /* margen visual en pantalla (no se imprime) */
    background: #fff center/cover no-repeat;
    position: relative;
    box-shadow: 0 8px 24px rgba(0,0,0,.15);
  }
  .page.no-shadow{ box-shadow:none; } /* se aplica al imprimir */

  /* ===== Fondo de cada hoja ===== */
  #p1{ background-image: url('plantilla_p1.jpg'); }
  #p2{ background-image: url('plantilla_p2.jpg'); }

  /* ===== Campos absolutamente posicionados =====
     - Usa unidades en mm para un calce 1:1 sobre la imagen
     - Ajusta top/left/width si lo necesitas milimétricamente
  */
  .field{
    position:absolute;
    height: 6mm;
    background: transparent;
    border: none;
    outline: none;
    padding: 0 1mm;
    font-size: 11px;
    color: #111;
  }
  /* subrayado opcional si te ayuda a ver dónde escribir (quitar para impresión limpia) */
  .field.debug { border-bottom: 0.3mm solid rgba(10,61,145,.35); }

  /* radios y chips */
  .chip{
    position:absolute;
    display:flex;
    align-items:center;
    gap:2mm;
    font-size: 11px;
    color:#111;
  }
  .chip input{ width: 4.5mm; height: 4.5mm; }

  /* Botón fijo (pantalla) */
  .toolbar{
    position:sticky; top:0; background:#0b3d91; color:#fff;
    display:flex; justify-content:center; gap:10px; padding:8px;
    z-index: 1000; box-shadow:0 6px 14px rgba(0,0,0,.15);
  }
  .btn{
    background:#fff; color:#0b3d91; border:0; padding:10px 16px;
    border-radius:8px; font-weight:700; cursor:pointer;
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed; }

  /* Ocultar elementos auxiliares al imprimir */
  @media print{
    .toolbar{ display:none; }
    body{ background:#fff; }
    .page{ margin:0; box-shadow:none !important; }
  }
</style>
</head>
<body>

<!-- Barra (un botón = Enviar + Imprimir) -->
<div class="toolbar">
  <button id="sendPrintBtn" class="btn" onclick="sendAndPrint()">Enviar a Google Sheets & Imprimir PDF</button>
</div>

<!-- ============ HOJA 1 ============ -->
<form id="hoyaForm">
  <div id="p1" class="page">

    <!-- ==== INFORMACIÓN PERSONAL (bloque azul) ==== -->
    <!-- Nombre del cliente (antes “Sistema operativo del cliente”) -->
    <input class="field" name="sistema" placeholder="Nombre del cliente"
           style="top: 116mm; left: 42mm; width: 154mm;">
    <!-- Nombre -->
    <input class="field" name="nombre"
           style="top: 124mm; left: 42mm; width: 154mm;">
    <!-- Apellidos -->
    <input class="field" name="apellidos"
           style="top: 132mm; left: 42mm; width: 154mm;">
    <!-- Sexo (Masculino) -->
    <label class="chip" style="top: 140mm; left: 60mm;">
      <input type="radio" name="sexo" value="Masculino"> Masculino
    </label>
    <!-- Sexo (Femenino) -->
    <label class="chip" style="top: 140mm; left: 100mm;">
      <input type="radio" name="sexo" value="Femenino"> Femenino
    </label>
    <!-- Fecha de nacimiento -->
    <input class="field" name="fecha_nac" type="date"
           style="top: 149mm; left: 42mm; width: 154mm;">

    <!-- ==== PRESCRIPCIÓN (al centro de la hoja) ==== -->
    <!-- Ojo izquierdo: Esférico / Cilíndrico / Eje / Adición -->
    <input class="field" name="esf_oi" style="top: 172mm; left: 54mm; width: 35mm;">
    <input class="field" name="cil_oi" style="top: 181mm; left: 54mm; width: 35mm;">
    <input class="field" name="eje_oi" style="top: 181mm; left: 105mm; width: 35mm;">
    <input class="field" name="adic_oi" style="top: 190mm; left: 54mm; width: 86mm;">

    <!-- Ojo derecho: Esférico / Cilíndrico / Eje / Adición -->
    <input class="field" name="esf_od" style="top: 172mm; left: 150mm; width: 35mm;">
    <input class="field" name="cil_od" style="top: 181mm; left: 150mm; width: 35mm;">
    <input class="field" name="eje_od" style="top: 181mm; left: 200mm; width: 35mm;">
    <input class="field" name="adic_od" style="top: 190mm; left: 150mm; width: 86mm;">

    <!-- Prisma (OI) Sí / No -->
    <label class="chip" style="top: 198mm; left: 58mm;">
      <input type="radio" name="prisma_oi" value="Si"> Sí
    </label>
    <label class="chip" style="top: 198mm; left: 82mm;">
      <input type="radio" name="prisma_oi" value="No"> No
    </label>

    <!-- Primer par de lentes Sí / No -->
    <label class="chip" style="top: 198mm; left: 160mm;">
      <input type="radio" name="primer_par" value="Si"> Sí
    </label>
    <label class="chip" style="top: 198mm; left: 182mm;">
      <input type="radio" name="primer_par" value="No"> No
    </label>

    <!-- ==== INFORMACIÓN DEL PRISMA ==== -->
    <!-- Ojo izquierdo: Horizontal valor y Nasal/Temporal -->
    <input class="field" name="prisma_h_oi_val" style="top: 212mm; left: 58mm; width: 35mm;">
    <label class="chip" style="top: 212mm; left: 96mm;">
      <input type="radio" name="horiz_oi" value="Nasal"> Nasal
    </label>
    <label class="chip" style="top: 212mm; left: 118mm;">
      <input type="radio" name="horiz_oi" value="Temporal"> Temporal
    </label>

    <!-- Ojo izquierdo: Vertical valor y Nasal/Temporal -->
    <input class="field" name="prisma_v_oi_val" style="top: 219mm; left: 58mm; width: 35mm;">
    <label class="chip" style="top: 219mm; left: 96mm;">
      <input type="radio" name="vert_oi" value="Nasal"> Nasal
    </label>
    <label class="chip" style="top: 219mm; left: 118mm;">
      <input type="radio" name="vert_oi" value="Temporal"> Temporal
    </label>

    <!-- Resultado OI -->
    <input class="field" name="prisma_res_oi" style="top: 227mm; left: 58mm; width: 57mm;">

    <!-- Ojo derecho: Horizontal valor y Nasal/Temporal -->
    <input class="field" name="prisma_h_od_val" style="top: 212mm; left: 154mm; width: 35mm;">
    <label class="chip" style="top: 212mm; left: 192mm;">
      <input type="radio" name="horiz_od" value="Nasal"> Nasal
    </label>
    <label class="chip" style="top: 212mm; left: 214mm;">
      <input type="radio" name="horiz_od" value="Temporal"> Temporal
    </label>

    <!-- Ojo derecho: Vertical valor y Nasal/Temporal -->
    <input class="field" name="prisma_v_od_val" style="top: 219mm; left: 154mm; width: 35mm;">
    <label class="chip" style="top: 219mm; left: 192mm;">
      <input type="radio" name="vert_od" value="Nasal"> Nasal
    </label>
    <label class="chip" style="top: 219mm; left: 214mm;">
      <input type="radio" name="vert_od" value="Temporal"> Temporal
    </label>

    <!-- Resultado OD -->
    <input class="field" name="prisma_res_od" style="top: 227mm; left: 154mm; width: 57mm;">

    <!-- ==== ESTILO DE VIDA (chips 0–100%) – Interiores ==== -->
    <!-- Te dejo 0%, 50% y 100% como ejemplo; duplica si quieres todos -->
    <label class="chip" style="top: 243mm; left: 88mm;">
      <input type="radio" name="int" value="0%"> 0%
    </label>
    <label class="chip" style="top: 243mm; left: 126mm;">
      <input type="radio" name="int" value="50%"> 50%
    </label>
    <label class="chip" style="top: 243mm; left: 168mm;">
      <input type="radio" name="int" value="100%"> 100%
    </label>

    <!-- Exteriores -->
    <label class="chip" style="top: 251mm; left: 88mm;">
      <input type="radio" name="ext" value="0%"> 0%
    </label>
    <label class="chip" style="top: 251mm; left: 126mm;">
      <input type="radio" name="ext" value="50%"> 50%
    </label>
    <label class="chip" style="top: 251mm; left: 168mm;">
      <input type="radio" name="ext" value="100%"> 100%
    </label>
  </div>

  <!-- ============ HOJA 2 ============ -->
  <div id="p2" class="page">

    <!-- ==== MEDIDAS DEL MARCO (al medio de la hoja) ==== -->
    <input class="field" name="dnp_oi"  style="top: 195mm; left: 64mm; width: 25mm;">
    <input class="field" name="dnp_od"  style="top: 195mm; left: 96mm; width: 25mm;">
    <input class="field" name="altura_pupilar_oi" style="top: 202mm; left: 64mm; width: 25mm;">
    <input class="field" name="altura_pupilar_od" style="top: 202mm; left: 96mm; width: 25mm;">
    <input class="field" name="altura_total_cristalino" style="top: 210mm; left: 64mm; width: 57mm;">
    <input class="field" name="distancia_al_vertice" style="top: 218mm; left: 64mm; width: 57mm;">
    <input class="field" name="inclinacion_pantoscopica" style="top: 195mm; left: 152mm; width: 30mm;">
    <input class="field" name="curva_del_borde" style="top: 202mm; left: 152mm; width: 30mm;">

    <!-- ==== GAFAS ANTERIORES ==== -->
    <input class="field" name="tipo_lente" style="top: 228mm; left: 64mm; width: 57mm;">
    <!-- proveedor: HOYA / Otro -->
    <label class="chip" style="top: 236mm; left: 80mm;"><input type="radio" name="proveedor" value="HOYA"> HOYA</label>
    <label class="chip" style="top: 236mm; left: 108mm;"><input type="radio" name="proveedor" value="Otro"> Otro</label>
    <input class="field" name="diseno" style="top: 244mm; left: 64mm; width: 57mm;">
    <input class="field" name="longitud_pasillo" style="top: 252mm; left: 84mm; width: 37mm;">

    <!-- ==== RECETA PREVIA ==== -->
    <!-- OI -->
    <input class="field" name="rp_esf_oi" style="top: 228mm; left: 156mm; width: 25mm;">
    <input class="field" name="rp_cil_oi" style="top: 236mm; left: 156mm; width: 25mm;">
    <input class="field" name="rp_eje_oi" style="top: 244mm; left: 156mm; width: 25mm;">
    <input class="field" name="rp_adic_oi" style="top: 252mm; left: 156mm; width: 25mm;">
    <!-- OD -->
    <input class="field" name="rp_esf_od" style="top: 228mm; left: 188mm; width: 25mm;">
    <input class="field" name="rp_cil_od" style="top: 236mm; left: 188mm; width: 25mm;">
    <input class="field" name="rp_eje_od" style="top: 244mm; left: 188mm; width: 25mm;">
    <input class="field" name="rp_adic_od" style="top: 252mm; left: 188mm; width: 25mm;">

    <!-- ==== NIVEL DE SATISFACCIÓN (chips) ==== -->
    <label class="chip" style="top: 268mm; left: 70mm;"><input type="radio" name="satisfaccion" value="Muy satisfecho"> Muy satisfecho</label>
    <label class="chip" style="top: 268mm; left: 110mm;"><input type="radio" name="satisfaccion" value="Satisfecho"> Satisfecho</label>
    <label class="chip" style="top: 268mm; left: 140mm;"><input type="radio" name="satisfaccion" value="Neutral"> Neutral</label>
    <label class="chip" style="top: 268mm; left: 160mm;"><input type="radio" name="satisfaccion" value="Insatisfecho"> Insatisfecho</label>
    <label class="chip" style="top: 268mm; left: 188mm;"><input type="radio" name="satisfaccion" value="Muy insatisfecho"> Muy insatisfecho</label>

  </div>
</form>

<script>
  // Reemplaza por tu URL publicada de Apps Script (Deploy → New deployment → Web app → access: Anyone)
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz8wYVJCHIBZPW2mzkpBkSUdGUzddeNmXcgpZmeTOfHHgiL1WcA1CMHIM8G4CaG5iMGEQ/exec";

  async function sendAndPrint(){
    const btn = document.getElementById('sendPrintBtn');
    btn.disabled = true;

    try{
      // agrega timestamp (lado cliente) – opcional
      const f = document.getElementById('hoyaForm');
      const fd = new FormData(f);
      fd.append('timestamp', new Date().toLocaleString());

      // Post al Web App (modo CORS abierto en tu despliegue)
      const resp = await fetch(WEB_APP_URL, { method:'POST', body: fd });
      // no-cors no permite leer resp; si tu script devuelve JSON y CORS, podrías chequear aquí

      // imprimir
      window.print();
    }catch(err){
      alert("Error al enviar/imprimir: "+err.message);
    }finally{
      btn.disabled = false;
    }
  }
</script>
</body>
</html>
