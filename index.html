<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Formulario Identifier – iD Myself – HOYALUX</title>

<style>
  /* ===== Paleta ===== */
  :root{
    --navy:#0a2d6f;
    --blue:#0b3d91;
    --grid:#dbe4ff;
    --accent:#7a2b6c;
    --accent-ink:#7a2b6c;
    --accent-bg:#f6e8f3;
    --ink:#0f172a;
    --muted:#475569;
    --card:#0b3d91;
    --bg:#eef2ff;
  }

  /* ===== Página ===== */
  @page{ size:A4; margin:12mm }
  html,body{height:100%}
  body{margin:0; background:var(--bg); font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; color:var(--ink)}
  .toolbar{ position:sticky; top:0; z-index:5; background:var(--navy); padding:10px; display:flex; justify-content:center }
  .btn-primary{
    background:#10327d; color:#fff; border:0; padding:10px 18px; border-radius:10px; font-weight:700; cursor:pointer
  }
  .btn-primary:disabled{ opacity:.6; cursor:default }
  .sheet{width:210mm; min-height:297mm; margin:0 auto; background:#fff; box-shadow:0 8px 24px rgba(2,6,23,.15);}

  .hero{position:relative; height:280px; overflow:hidden}
  .hero img{width:100%; height:100%; object-fit:cover; object-position:35% 35%}
  .band{position:absolute; left:0; right:0; bottom:16px; display:flex; justify-content:center}
  .band .title{background:var(--navy); color:#fff; padding:10px 22px; border-radius:8px; letter-spacing:.06em; font-weight:800; font-size:20px; box-shadow:0 8px 18px rgba(2,6,23,.25)}

  .section{ padding:8mm 12mm }
  .section-title{ color:var(--accent-ink); font-weight:800; font-size:13px; letter-spacing:.4px; display:flex; align-items:center; gap:10px; margin:0 0 8px }
  .section-title::before{ content:""; width:12px; height:12px; background:var(--blue); border-radius:3px }

  /* ===== Grid ===== */
  .grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:10px 14px; align-items:end }
  .col-12{grid-column:span 12}
  .col-8{grid-column:span 8}
  .col-7{grid-column:span 7}
  .col-6{grid-column:span 6}
  .col-5{grid-column:span 5}
  .col-4{grid-column:span 4}
  .col-3{grid-column:span 3}
  .col-2{grid-column:span 2}

  label{ font-size:11px; color:var(--muted); display:block; margin-bottom:3px }
  .line{ width:100%; border:none; border-bottom:1px solid var(--grid); padding:6px 2px; font:inherit; background:transparent; color:var(--ink) }
  .line::placeholder{ color:#98a2b3 }
  .line:focus{ outline:none; border-bottom-color:var(--blue) }

  /* ===== Tarjeta Información Personal (azul) ===== */
  .personal{
    background:var(--card); color:#e6eefc; padding:22px 24px 20px; border-radius:10px; margin-top:-22px;
    --g:22px; background-image:
      linear-gradient(rgba(255,255,255,.08) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,.08) 1px, transparent 1px);
    background-size:var(--g) var(--g), var(--g) var(--g);
  }
  .personal .section-title{ color:#fff }
  .personal .section-title::before{ background:#fff }
  .personal label{ color:#e6eefc }
  .personal .line{ border-bottom:1.6px solid rgba(255,255,255,.7); color:#fff }
  .personal .line::placeholder{ color:#cfe2f8 }

  /* ===== Chips generales ===== */
  .chips{ display:flex; flex-wrap:wrap; gap:8px; align-items:center }
  .chip-group{ display:flex; gap:8px; align-items:center }
  .chip-wrap{ position:relative; display:inline-flex; align-items:center }
  .chip-wrap input{ position:absolute; opacity:0; width:0; height:0 }
  .chip{ padding:6px 12px; border:1px solid #e2e8f0; border-radius:999px; background:#fff; color:#0f172a; font-size:12px; line-height:1.2; cursor:pointer; user-select:none }
  .chip-wrap input:checked + .chip{ background:var(--accent-bg); border-color:#e7cfe0; color:var(--accent-ink); box-shadow:0 0 0 2px #f3cfe355 inset }
  .chip-sep{ color:#64748b; font-weight:700; user-select:none }

  /* ===== Chips “Nasal / Temporal” inline (no mover layout) ===== */
  .chips-inline{ display:inline-flex; gap:8px; align-items:center; vertical-align:middle }
  .chips-inline .chip-wrap{ position:relative; display:inline-flex; align-items:center }
  .chips-inline input{ position:absolute; opacity:0; width:0; height:0 }
  .chips-inline .chip{ padding:4px 12px; border:1px solid #e2e8f0; border-radius:999px; background:#fff; color:#0f172a; font-size:12px; line-height:1.2; cursor:pointer; user-select:none }
  .chips-inline input:checked + .chip{ background:var(--accent-bg); border-color:#e7cfe0; color:var(--accent-ink); box-shadow:0 0 0 2px #f3cfe355 inset }
  .chips-inline .chip-sep{ color:#64748b; font-weight:700 }

  /* Campos suaves rectangulares (para coincidencia con tu maqueta rosada) */
  .soft .line{ background:#fbf5fa; border:1px solid #ead7e7; border-radius:4px; padding:8px 10px }

  /* Fila prisma: etiqueta | valor (mm) | chips */
  .pr-row{ display:grid; grid-template-columns:150px minmax(120px,1fr) auto; align-items:center; gap:8px; margin:8px 0 }
  .pr-row .box{ background:#fbf5fa; border:1px solid #ead7e7; border-radius:4px; height:30px; padding:6px 8px; width:120px }

  /* Tabla de 0..5 (resumen) – la puedes adaptar si la usas */
  table{ border-collapse:collapse; width:100% }
  .imp-table{ font-size:11.5px; margin-top:6px }
  .imp-table th,.imp-table td{ border:1px solid #eef2ff; padding:6px 8px; vertical-align:top }
  .imp-table th{ background:#f8fafc; color:#334155; font-weight:700 }
  .imp-table tr:nth-child(even){ background:#fafafe }

  /* Footer logos */
  .page-footer{ display:flex; justify-content:space-between; align-items:center; padding:8mm 12mm 12mm }
  .logo-hoya{ height:18mm }
  .logo-tech{ height:16mm }

  /* Print */
  @media print{
    .toolbar{ display:none }
    .sheet{ box-shadow:none }
    body{ background:#fff }
  }
</style>
</head>
<body>

<!-- Botón único -->
<div class="toolbar">
  <button class="btn-primary" id="btnSendPrint">Enviar a Google Sheets & Imprimir PDF</button>
</div>

<div class="sheet">
  <!-- Encabezado con imagen -->
  <div class="hero">
    <img src="idmyself_header.jpg" alt="HOYA Header"/>
    <div class="band"><div class="title">FORMULARIO IDENTIFIER · iD MYSELF · HOYALUX</div></div>
  </div>

  <!-- Información personal (tarjeta azul) -->
  <section class="section">
    <div class="personal">
      <h3 class="section-title">INFORMACIÓN PERSONAL</h3>
      <div class="grid">
        <div class="col-12">
          <label>Nombre del cliente</label>
          <input class="line" name="sistema" placeholder="Escribe el nombre completo"/>
        </div>

        <div class="col-6">
          <label>Nombre</label>
          <input class="line" name="nombre"/>
        </div>
        <div class="col-6">
          <label>Apellidos</label>
          <input class="line" name="apellidos"/>
        </div>

        <div class="col-4">
          <label>Sexo</label>
          <div class="chip-group">
            <label class="chip-wrap">
              <input type="radio" name="sexo" value="Masculino"/>
              <span class="chip">Masculino</span>
            </label>
            <label class="chip-wrap">
              <input type="radio" name="sexo" value="Femenino"/>
              <span class="chip">Femenino</span>
            </label>
          </div>
        </div>
        <div class="col-8">
          <label>Fecha de nacimiento</label>
          <input class="line" type="date" name="fecha_nac" placeholder="dd/mm/aaaa"/>
        </div>
      </div>
    </div>
  </section>

  <!-- Prescripción -->
  <section class="section">
    <h3 class="section-title">PRESCRIPCIÓN</h3>
    <div class="grid soft">
      <div class="col-6"><strong>Ojo izquierdo</strong></div>
      <div class="col-6"><strong>Ojo derecho</strong></div>

      <div class="col-2"><label>Esférico</label><input class="line" name="esf_oi"/></div>
      <div class="col-2"><label>Cilíndrico</label><input class="line" name="cil_oi"/></div>
      <div class="col-2"><label>Eje</label><input class="line" name="eje_oi"/></div>

      <div class="col-2"><label>Esférico</label><input class="line" name="esf_od"/></div>
      <div class="col-2"><label>Cilíndrico</label><input class="line" name="cil_od"/></div>
      <div class="col-2"><label>Eje</label><input class="line" name="eje_od"/></div>

      <div class="col-3"><label>Adición OI</label><input class="line" name="adic_oi"/></div>
      <div class="col-3">
        <label>Prisma OI</label>
        <div class="chip-group">
          <label class="chip-wrap"><input type="radio" name="prisma_oi" value="Sí"/><span class="chip">Sí</span></label>
          <label class="chip-wrap"><input type="radio" name="prisma_oi" value="No"/><span class="chip">No</span></label>
        </div>
      </div>

      <div class="col-3"><label>Adición OD</label><input class="line" name="adic_od"/></div>
      <div class="col-3">
        <label>Primer par de lentes</label>
        <div class="chip-group">
          <label class="chip-wrap"><input type="radio" name="primer_par" value="Sí"/><span class="chip">Sí</span></label>
          <label class="chip-wrap"><input type="radio" name="primer_par" value="No"/><span class="chip">No</span></label>
        </div>
      </div>
    </div>
  </section>

  <!-- Información del prisma -->
  <section class="section">
    <h3 class="section-title">INFORMACIÓN DEL PRISMA</h3>
    <div class="grid">
      <div class="col-6"><strong>Ojo izquierdo</strong></div>
      <div class="col-6"><strong>Ojo derecho</strong></div>

      <!-- OI Horizontal -->
      <div class="col-6">
        <div class="pr-row">
          <label>Horizontal (valor)</label>
          <input class="box" name="prisma_h_oi_val" placeholder="mm"/>
          <span class="chips-inline">
            <label class="chip-wrap">
              <input type="radio" name="horiz_oi" value="Nasal"/>
              <span class="chip">Nasal</span>
            </label>
            <span class="chip-sep">ó</span>
            <label class="chip-wrap">
              <input type="radio" name="horiz_oi" value="Temporal"/>
              <span class="chip">Temporal</span>
            </label>
          </span>
        </div>

        <div class="pr-row">
          <label>Vertical (valor)</label>
          <input class="box" name="prisma_v_oi_val" placeholder="mm"/>
          <span class="chips-inline">
            <label class="chip-wrap">
              <input type="radio" name="vert_oi" value="Nasal"/>
              <span class="chip">Nasal</span>
            </label>
            <span class="chip-sep">ó</span>
            <label class="chip-wrap">
              <input type="radio" name="vert_oi" value="Temporal"/>
              <span class="chip">Temporal</span>
            </label>
          </span>
        </div>

        <div class="pr-row">
          <label>Resultado</label>
          <input class="box" name="prisma_res_oi" placeholder=""/>
          <div></div>
        </div>
      </div>

      <!-- OD Horizontal -->
      <div class="col-6">
        <div class="pr-row">
          <label>Horizontal (valor)</label>
          <input class="box" name="prisma_h_od_val" placeholder="mm"/>
          <span class="chips-inline">
            <label class="chip-wrap">
              <input type="radio" name="horiz_od" value="Nasal"/>
              <span class="chip">Nasal</span>
            </label>
            <span class="chip-sep">ó</span>
            <label class="chip-wrap">
              <input type="radio" name="horiz_od" value="Temporal"/>
              <span class="chip">Temporal</span>
            </label>
          </span>
        </div>

        <div class="pr-row">
          <label>Vertical (valor)</label>
          <input class="box" name="prisma_v_od_val" placeholder="mm"/>
          <span class="chips-inline">
            <label class="chip-wrap">
              <input type="radio" name="vert_od" value="Nasal"/>
              <span class="chip">Nasal</span>
            </label>
            <span class="chip-sep">ó</span>
            <label class="chip-wrap">
              <input type="radio" name="vert_od" value="Temporal"/>
              <span class="chip">Temporal</span>
            </label>
          </span>
        </div>

        <div class="pr-row">
          <label>Resultado</label>
          <input class="box" name="prisma_res_od" placeholder=""/>
          <div></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Estilo de vida (interiores/exteriores) -->
  <section class="section">
    <h3 class="section-title">ESTILO DE VIDA · ¿Dónde pasas el día?</h3>
    <div class="grid">
      <div class="col-12"><label>Ambientes interiores</label></div>
      <div class="col-12 chips">
        <!-- name=int -->
        <label class="chip-wrap"><input type="radio" name="int" value="0%"><span class="chip">0%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="10%"><span class="chip">10%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="20%"><span class="chip">20%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="30%"><span class="chip">30%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="40%"><span class="chip">40%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="50%"><span class="chip">50%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="60%"><span class="chip">60%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="70%"><span class="chip">70%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="80%"><span class="chip">80%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="90%"><span class="chip">90%</span></label>
        <label class="chip-wrap"><input type="radio" name="int" value="100%"><span class="chip">100%</span></label>
      </div>

      <div class="col-12"><label>Ambientes exteriores</label></div>
      <div class="col-12 chips">
        <!-- name=ext -->
        <label class="chip-wrap"><input type="radio" name="ext" value="0%"><span class="chip">0%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="10%"><span class="chip">10%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="20%"><span class="chip">20%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="30%"><span class="chip">30%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="40%"><span class="chip">40%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="50%"><span class="chip">50%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="60%"><span class="chip">60%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="70%"><span class="chip">70%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="80%"><span class="chip">80%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="90%"><span class="chip">90%</span></label>
        <label class="chip-wrap"><input type="radio" name="ext" value="100%"><span class="chip">100%</span></label>
      </div>
    </div>
  </section>

  <!-- Medidas del marco + Gafas anteriores + Receta previa + Satisfacción -->
  <section class="section">
    <h3 class="section-title">MEDIDAS DEL MARCO</h3>
    <div class="grid soft">
      <div class="col-3"><label>DNP Ojo izquierdo</label><input class="line" name="dnp_oi" placeholder="mm"/></div>
      <div class="col-3"><label>DNP Ojo derecho</label><input class="line" name="dnp_od" placeholder="mm"/></div>
      <div class="col-3"><label>Altura pupilar OI</label><input class="line" name="altura_pupilar_oi" placeholder="mm"/></div>
      <div class="col-3"><label>Altura pupilar OD</label><input class="line" name="altura_pupilar_od" placeholder="mm"/></div>

      <div class="col-3"><label>Altura total del cristalino</label><input class="line" name="altura_total_cristalino" placeholder="mm"/></div>
      <div class="col-3"><label>Distancia al vértice</label><input class="line" name="distancia_al_vertice" placeholder="mm"/></div>
      <div class="col-3"><label>Inclinación pantoscópica</label><input class="line" name="inclinacion_pantoscopica" placeholder="grado"/></div>
      <div class="col-3"><label>Curva del borde</label><input class="line" name="curva_del_borde" placeholder="grado"/></div>
    </div>

    <h3 class="section-title" style="margin-top:10px">GAFAS ANTERIORES</h3>
    <div class="grid soft">
      <div class="col-3"><label>Tipo de lente</label><input class="line" name="tipo_lente"/></div>
      <div class="col-3">
        <label>Proveedor</label>
        <div class="chip-group">
          <label class="chip-wrap"><input type="radio" name="proveedor" value="HOYA"/><span class="chip">HOYA</span></label>
          <label class="chip-wrap"><input type="radio" name="proveedor" value="Otro"/><span class="chip">Otro</span></label>
        </div>
      </div>
      <div class="col-3"><label>Diseño</label><input class="line" name="diseno"/></div>
      <div class="col-3"><label>Longitud del pasillo</label><input class="line" name="longitud_pasillo" placeholder=""/></div>
    </div>

    <h3 class="section-title" style="margin-top:10px">RECETA PREVIA</h3>
    <div class="grid soft">
      <div class="col-6"><strong>Ojo izquierdo</strong></div>
      <div class="col-6"><strong>Ojo derecho</strong></div>

      <div class="col-3"><label>Cilíndrico OI</label><input class="line" name="rp_cil_oi"/></div>
      <div class="col-3"><label>Esférico OI</label><input class="line" name="rp_esf_oi"/></div>
      <div class="col-3"><label>Eje OI</label><input class="line" name="rp_eje_oi"/></div>
      <div class="col-3"><label>Adición OI</label><input class="line" name="rp_adic_oi"/></div>

      <div class="col-3"><label>Cilíndrico OD</label><input class="line" name="rp_cil_od"/></div>
      <div class="col-3"><label>Esférico OD</label><input class="line" name="rp_esf_od"/></div>
      <div class="col-3"><label>Eje OD</label><input class="line" name="rp_eje_od"/></div>
      <div class="col-3"><label>Adición OD</label><input class="line" name="rp_adic_od"/></div>
    </div>

    <h3 class="section-title" style="margin-top:10px">NIVEL DE SATISFACCIÓN</h3>
    <div class="grid">
      <div class="col-12 chip-group">
        <label class="chip-wrap"><input type="radio" name="satisfaccion" value="Muy satisfecho"/><span class="chip">Muy satisfecho</span></label>
        <label class="chip-wrap"><input type="radio" name="satisfaccion" value="Satisfecho"/><span class="chip">Satisfecho</span></label>
        <label class="chip-wrap"><input type="radio" name="satisfaccion" value="Neutral"/><span class="chip">Neutral</span></label>
        <label class="chip-wrap"><input type="radio" name="satisfaccion" value="Insatisfecho"/><span class="chip">Insatisfecho</span></label>
        <label class="chip-wrap"><input type="radio" name="satisfaccion" value="Muy insatisfecho"/><span class="chip">Muy insatisfecho</span></label>
      </div>
    </div>
  </section>

  <!-- Footer con logos -->
  <div class="page-footer">
    <img src="Imagen_Hoya.jpg" alt="HOYA" class="logo-hoya"/>
    <img src="Imagen_tecnologia.jpg" alt="Tecnología Japonesa para la Visión" class="logo-tech"/>
  </div>
</div>

<script>
  // URL de tu Apps Script (versión desplegada como Web App)
  const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8wYVJCHIBZPW2mzkpBkSUdGUzddeNmXcgpZmeTOfHHgiL1WcA1CMHIM8G4CaG5iMGEQ/exec";

  function serializeData() {
    const data = {};
    const all = document.querySelectorAll("input, textarea, select");
    all.forEach(el => {
      if (!el.name) return;

      if (el.type === "radio") {
        if (el.checked) data[el.name] = el.value;
        else if (!(el.name in data)) data[el.name] = ""; // garantizar columna
      } else if (el.type === "checkbox") {
        // por si luego agregas checks de actividades
        data[el.name] = el.checked ? "Sí" : (data[el.name] ?? "");
      } else {
        data[el.name] = el.value ?? "";
      }
    });

    // timestamp
    data.timestamp = new Date().toLocaleString();

    return data;
  }

  async function sendToSheet(data){
    // Para evitar problemas CORS con Apps Script, usamos no-cors
    try{
      await fetch(APPS_SCRIPT_URL, {
        method: "POST",
        mode: "no-cors",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(data)
      });
      // No podremos leer respuesta en no-cors, pero el envío se dispara.
    }catch(e){
      console.error(e);
    }
  }

  document.getElementById("btnSendPrint").addEventListener("click", async (e)=>{
    const btn = e.currentTarget;
    btn.disabled = true;
    btn.textContent = "Enviando...";

    const payload = serializeData();
    await sendToSheet(payload);

    btn.textContent = "Imprimiendo...";
    window.print();

    btn.textContent = "Enviar a Google Sheets & Imprimir PDF";
    btn.disabled = false;
  });
</script>
</body>
</html>

