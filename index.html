<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Formulario Identifier – iD MYSELF – HOYALUX</title>
  <style>
    :root{
      --hoya-navy:#0a2d6f;
      --hoya-blue:#0b3d91;
      --accent:#7a2b6c;
      --ink:#0f172a;
      --muted:#475569;
      --soft:#f7f7fb;
      --line:#e6e8f2;
    }
    *{box-sizing:border-box}
    body{margin:0; background:#eef2ff; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial; color:var(--ink)}
    .sheet{width:min(1200px,96%); margin:18px auto; background:#fff; border-radius:14px; box-shadow:0 10px 30px rgba(2,6,23,.15)}
    .section{padding:22px 24px}
    h3.section-title{margin:0 0 14px; font-size:18px; color:var(--accent); letter-spacing:.2px; display:flex; align-items:center; gap:8px}
    h3.section-title::before{content:""; width:12px; height:12px; background:var(--hoya-blue); border-radius:3px}
    .grid{display:grid; gap:12px}
    @media (min-width:900px){
      .grid.cols-2{grid-template-columns:1fr 1fr}
      .grid.cols-3{grid-template-columns:repeat(3,1fr)}
      .grid.cols-4{grid-template-columns:repeat(4,1fr)}
    }
    label{font-size:13px; color:var(--muted)}
    input[type=text], input[type=number], input[type=date], select, .pill {
      width:100%; border:1px solid var(--line); border-radius:7px; background:#fff; color:var(--ink);
      padding:9px 10px; font-size:14px
    }
    .pill{background:#f9f9ff}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--line); padding:8px 12px; border-radius:999px; background:#fff; cursor:pointer}
    .chip input{accent-color:var(--hoya-navy)}
    /* Panel azul */
    .personal{background:#0b3d91;color:#e6eefc;border-radius:12px;margin:18px 18px 6px;padding:24px}
    .personal h3.section-title{color:#fff}
    .personal h3.section-title::before{background:#fff}
    .personal label{color:#eaf2ff}
    .personal input, .personal select{
      background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.6); color:#fff
    }
    .minor{font-size:12px;color:#6b7280}
    hr.sep{border:none;border-top:1px solid var(--line); margin:12px 0}
    .actions{display:flex; gap:12px; padding:18px; justify-content:flex-start}
    .btn{
      background:var(--hoya-navy); color:#fff; border:none; border-radius:10px; padding:12px 16px; font-weight:700;
      cursor:pointer; box-shadow:0 8px 20px rgba(10,45,111,.25)
    }
    .btn[disabled]{opacity:.6; cursor:not-allowed}
    .ok{color:#0a7f2a}
    .err{color:#b42318}
    @media print{
      .actions, .hint, .minor {display:none !important}
      body{background:#fff}
      .sheet{box-shadow:none; width:100%; margin:0; border-radius:0}
    }
  </style>
</head>
<body>
  <div class="sheet">
    <!-- =================== INFORMACIÓN PERSONAL (azul) =================== -->
    <section class="section personal">
      <h3 class="section-title">INFORMACIÓN PERSONAL</h3>
      <div class="grid cols-2">
        <!-- IMPORTANTE: mantenemos name="sistema" para que siga grabando en tu columna 'sistema' -->
        <div>
          <label for="sistema">Nombre del Cliente</label>
          <input id="sistema" name="sistema" placeholder="Ingrese el nombre del cliente" />
        </div>
        <div></div>
        <div>
          <label for="nombre">Nombre</label>
          <input id="nombre" name="nombre" />
        </div>
        <div>
          <label for="apellidos">Apellidos</label>
          <input id="apellidos" name="apellidos" />
        </div>
        <div>
          <label>Sexo</label>
          <div class="chips">
            <label class="chip"><input type="radio" name="sexo" value="Masculino"> Masculino</label>
            <label class="chip"><input type="radio" name="sexo" value="Femenino"> Femenino</label>
          </div>
        </div>
        <div>
          <label for="fecha_nac">Fecha de nacimiento</label>
          <input type="date" id="fecha_nac" name="fecha_nac" />
        </div>
      </div>
    </section>

    <!-- =================== PRESCRIPCIÓN =================== -->
    <section class="section">
      <h3 class="section-title">PRESCRIPCIÓN</h3>
      <div class="grid cols-2">
        <div>
          <h4>Ojo izquierdo</h4>
          <div class="grid cols-3">
            <div><label>Esférico</label><input type="text" name="esf_oi"></div>
            <div><label>Cilíndrico</label><input type="text" name="cil_oi"></div>
            <div><label>Eje</label><input type="text" name="eje_oi"></div>
          </div>
          <div style="margin-top:8px"><label>Adición</label><input type="text" name="adic_oi"></div>
        </div>
        <div>
          <h4>Ojo derecho</h4>
          <div class="grid cols-3">
            <div><label>Esférico</label><input type="text" name="esf_od"></div>
            <div><label>Cilíndrico</label><input type="text" name="cil_od"></div>
            <div><label>Eje</label><input type="text" name="eje_od"></div>
          </div>
          <div style="margin-top:8px"><label>Adición</label><input type="text" name="adic_od"></div>
        </div>
      </div>
    </section>

    <!-- =================== PRISMA =================== -->
    <section class="section">
      <h3 class="section-title">INFORMACIÓN DEL PRISMA</h3>
      <div class="grid cols-2">
        <div>
          <h4>Ojo izquierdo</h4>
          <div class="grid cols-2">
            <div>
              <label>Horizontal (mm)</label>
              <input type="text" name="prisma_h_oi_val" placeholder="mm">
            </div>
            <div>
              <label>Dirección</label>
              <div class="chips">
                <label class="chip"><input type="radio" name="horiz_oi" value="Nasal"> Nasal</label>
                <label class="chip"><input type="radio" name="horiz_oi" value="Temporal"> Temporal</label>
              </div>
            </div>
            <div>
              <label>Vertical (mm)</label>
              <input type="text" name="prisma_v_oi_val" placeholder="mm">
            </div>
            <div>
              <label>Dirección</label>
              <div class="chips">
                <label class="chip"><input type="radio" name="vert_oi" value="Nasal"> Nasal</label>
                <label class="chip"><input type="radio" name="vert_oi" value="Temporal"> Temporal</label>
              </div>
            </div>
          </div>
          <div style="margin-top:8px"><label>Resultado</label><input type="text" name="prisma_res_oi"></div>
          <div style="margin-top:8px">
            <label>Prisma</label>
            <div class="chips">
              <label class="chip"><input type="radio" name="prisma_oi" value="Sí"> Sí</label>
              <label class="chip"><input type="radio" name="prisma_oi" value="No"> No</label>
            </div>
          </div>
        </div>
        <div>
          <h4>Ojo derecho</h4>
          <div class="grid cols-2">
            <div>
              <label>Horizontal (mm)</label>
              <input type="text" name="prisma_h_od_val" placeholder="mm">
            </div>
            <div>
              <label>Dirección</label>
              <div class="chips">
                <label class="chip"><input type="radio" name="horiz_od" value="Nasal"> Nasal</label>
                <label class="chip"><input type="radio" name="horiz_od" value="Temporal"> Temporal</label>
              </div>
            </div>
            <div>
              <label>Vertical (mm)</label>
              <input type="text" name="prisma_v_od_val" placeholder="mm">
            </div>
            <div>
              <label>Dirección</label>
              <div class="chips">
                <label class="chip"><input type="radio" name="vert_od" value="Nasal"> Nasal</label>
                <label class="chip"><input type="radio" name="vert_od" value="Temporal"> Temporal</label>
              </div>
            </div>
          </div>
          <div style="margin-top:8px"><label>Resultado</label><input type="text" name="prisma_res_od"></div>
        </div>
      </div>
      <hr class="sep">
      <div>
        <label>¿Primer par de lentes?</label>
        <div class="chips">
          <label class="chip"><input type="radio" name="primer_par" value="Sí"> Sí</label>
          <label class="chip"><input type="radio" name="primer_par" value="No"> No</label>
        </div>
      </div>
    </section>

    <!-- =================== ESTILO DE VIDA =================== -->
    <section class="section">
      <h3 class="section-title">ESTILO DE VIDA · ¿Dónde pasas el día?</h3>
      <div class="grid">
        <div>
          <label>Ambientes interiores</label>
          <div class="chips">
            <label class="chip"><input type="radio" name="int" value="0%">0%</label>
            <label class="chip"><input type="radio" name="int" value="10%">10%</label>
            <label class="chip"><input type="radio" name="int" value="20%">20%</label>
            <label class="chip"><input type="radio" name="int" value="30%">30%</label>
            <label class="chip"><input type="radio" name="int" value="40%">40%</label>
            <label class="chip"><input type="radio" name="int" value="50%">50%</label>
            <label class="chip"><input type="radio" name="int" value="60%">60%</label>
            <label class="chip"><input type="radio" name="int" value="70%">70%</label>
            <label class="chip"><input type="radio" name="int" value="80%">80%</label>
            <label class="chip"><input type="radio" name="int" value="90%">90%</label>
            <label class="chip"><input type="radio" name="int" value="100%">100%</label>
          </div>
        </div>
        <div>
          <label>Ambientes exteriores</label>
          <div class="chips">
            <label class="chip"><input type="radio" name="ext" value="0%">0%</label>
            <label class="chip"><input type="radio" name="ext" value="10%">10%</label>
            <label class="chip"><input type="radio" name="ext" value="20%">20%</label>
            <label class="chip"><input type="radio" name="ext" value="30%">30%</label>
            <label class="chip"><input type="radio" name="ext" value="40%">40%</label>
            <label class="chip"><input type="radio" name="ext" value="50%">50%</label>
            <label class="chip"><input type="radio" name="ext" value="60%">60%</label>
            <label class="chip"><input type="radio" name="ext" value="70%">70%</label>
            <label class="chip"><input type="radio" name="ext" value="80%">80%</label>
            <label class="chip"><input type="radio" name="ext" value="90%">90%</label>
            <label class="chip"><input type="radio" name="ext" value="100%">100%</label>
          </div>
        </div>
      </div>
      <hr class="sep">
      <div class="grid cols-2">
        <div>
          <label>Viendo TV (0–5)</label><input type="number" name="tv" min="0" max="5">
          <label>Compras (0–5)</label><input type="number" name="compras" min="0" max="5">
          <label>Conducir (0–5)</label><input type="number" name="drive" min="0" max="5">
          <div class="minor">Detalles Conducir</div>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="drive_auto" value="Si"> Auto</label>
            <label class="chip"><input type="checkbox" name="drive_bus" value="Si"> Autobús</label>
            <label class="chip"><input type="checkbox" name="drive_moto" value="Si"> Moto</label>
            <label class="chip"><input type="checkbox" name="drive_tren" value="Si"> Tren</label>
            <label class="chip"><input type="checkbox" name="drive_camion" value="Si"> Camión</label>
          </div>
        </div>
        <div>
          <label>Vida profesional (0–5)</label><input type="number" name="vida" min="0" max="5">
          <div class="minor">Detalles Vida profesional</div>
          <div class="chips">
            <label class="chip"><input type="checkbox" name="work_cerca" value="Si"> Cerca</label>
            <label class="chip"><input type="checkbox" name="work_inter_cercano" value="Si"> Intermedio y cercano</label>
            <label class="chip"><input type="checkbox" name="work_inter_laboral" value="Si"> Intermedio laboral</label>
            <label class="chip"><input type="checkbox" name="work_lejos" value="Si"> Lejos</label>
            <label class="chip"><input type="checkbox" name="work_inter_lejano" value="Si"> Intermedio y lejano</label>
          </div>
          <label>Deportes y recreación (0–5)</label><input type="number" name="sport" min="0" max="5">
          <div class="chips">
            <label class="chip"><input type="checkbox" name="sport_gimnasia" value="Si"> Gimnasia</label>
            <label class="chip"><input type="checkbox" name="sport_correr" value="Si"> Correr / caminar</label>
            <label class="chip"><input type="checkbox" name="sport_golf" value="Si"> Golf</label>
            <label class="chip"><input type="checkbox" name="sport_tenis" value="Si"> Tenis</label>
            <label class="chip"><input type="checkbox" name="sport_pelota" value="Si"> Juegos de pelota</label>
            <label class="chip"><input type="checkbox" name="sport_ciclismo" value="Si"> Ciclismo</label>
          </div>
          <label>Computadoras / dispositivos (0–5)</label><input type="number" name="comp" min="0" max="5">
          <div class="chips">
            <label class="chip"><input type="checkbox" name="comp_pc" value="Si"> Computador</label>
            <label class="chip"><input type="checkbox" name="comp_portatil" value="Si"> Portátil</label>
            <label class="chip"><input type="checkbox" name="comp_varios" value="Si"> Varios disp.</label>
            <label class="chip"><input type="checkbox" name="comp_tableta" value="Si"> Tableta</label>
            <label class="chip"><input type="checkbox" name="comp_phone" value="Si"> Teléfonos</label>
          </div>
          <label>Lectura (0–5)</label><input type="number" name="lect" min="0" max="5">
          <div class="chips">
            <label class="chip"><input type="checkbox" name="lect_libro" value="Si"> Libro</label>
            <label class="chip"><input type="checkbox" name="lect_digital" value="Si"> Dispositivos digitales</label>
            <label class="chip"><input type="checkbox" name="lect_periodico" value="Si"> Periódico</label>
            <label class="chip"><input type="checkbox" name="lect_revista" value="Si"> Revista</label>
            <label class="chip"><input type="checkbox" name="lect_varios" value="Si"> Varios medios</label>
          </div>
        </div>
      </div>
    </section>

    <!-- =================== MEDIDAS DEL MARCO =================== -->
    <section class="section">
      <h3 class="section-title">MEDIDAS DEL MARCO</h3>
      <div class="grid cols-4">
        <div><label>DNP OI (mm)</label><input type="text" name="dnp_oi"></div>
        <div><label>DNP OD (mm)</label><input type="text" name="dnp_od"></div>
        <div><label>Altura pupilar OI (mm)</label><input type="text" name="altura_pupilar_oi"></div>
        <div><label>Altura pupilar OD (mm)</label><input type="text" name="altura_pupilar_od"></div>
        <div><label>Altura total del cristalino (mm)</label><input type="text" name="altura_total_cristalino"></div>
        <div><label>Distancia al vértice (mm)</label><input type="text" name="distancia_al_vertice"></div>
        <div><label>Inclinación pantoscópica (°)</label><input type="text" name="inclinacion_pantoscopica"></div>
        <div><label>Curva del borde (°)</label><input type="text" name="curva_del_borde"></div>
      </div>
    </section>

    <!-- =================== GAFAS ANTERIORES =================== -->
    <section class="section">
      <h3 class="section-title">GAFAS ANTERIORES</h3>
      <div class="grid cols-4">
        <div><label>Tipo de lente</label><input type="text" name="tipo_lente"></div>
        <div>
          <label>Proveedor</label>
          <div class="chips">
            <label class="chip"><input type="radio" name="proveedor" value="HOYA"> HOYA</label>
            <label class="chip"><input type="radio" name="proveedor" value="Otro"> Otro</label>
          </div>
        </div>
        <div><label>Diseño</label><input type="text" name="diseno"></div>
        <div><label>Longitud del pasillo</label><input type="text" name="longitud_pasillo" placeholder="p.ej. Desconocido"></div>
      </div>
    </section>

    <!-- =================== RECETA PREVIA =================== -->
    <section class="section">
      <h3 class="section-title">RECETA PREVIA</h3>
      <div class="grid cols-2">
        <div>
          <h4>Ojo izquierdo</h4>
          <div class="grid cols-4">
            <div><label>Cilíndrico</label><input type="text" name="rp_cil_oi"></div>
            <div><label>Esférico</label><input type="text" name="rp_esf_oi"></div>
            <div><label>Eje</label><input type="text" name="rp_eje_oi"></div>
            <div><label>Adición</label><input type="text" name="rp_adic_oi"></div>
          </div>
        </div>
        <div>
          <h4>Ojo derecho</h4>
          <div class="grid cols-4">
            <div><label>Cilíndrico</label><input type="text" name="rp_cil_od"></div>
            <div><label>Esférico</label><input type="text" name="rp_esf_od"></div>
            <div><label>Eje</label><input type="text" name="rp_eje_od"></div>
            <div><label>Adición</label><input type="text" name="rp_adic_od"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- =================== SATISFACCIÓN =================== -->
    <section class="section">
      <h3 class="section-title">NIVEL DE SATISFACCIÓN</h3>
      <div class="chips">
        <label class="chip"><input type="radio" name="satisfaccion" value="Muy satisfecho"> Muy satisfecho</label>
        <label class="chip"><input type="radio" name="satisfaccion" value="Satisfecho"> Satisfecho</label>
        <label class="chip"><input type="radio" name="satisfaccion" value="Neutral"> Neutral</label>
        <label class="chip"><input type="radio" name="satisfaccion" value="Insatisfecho"> Insatisfecho</label>
        <label class="chip"><input type="radio" name="satisfaccion" value="Muy insatisfecho"> Muy insatisfecho</label>
      </div>
    </section>

    <!-- =================== ACCIÓN ÚNICA =================== -->
    <div class="actions">
      <button id="btnSubmit" class="btn">Guardar en Google Sheets y Descargar PDF</button>
      <div id="msg" class="minor"></div>
    </div>
  </div>

  <script>
    // === URL de tu Apps Script (implementación web: cualquiera con el vínculo) ===
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz8wYVJCHIBZPW2mzkpBkSUdGUzddeNmXcgpZmeTOfHHgiL1WcA1CMHIM8G4CaG5iMGEQ/exec";

    // Ayuda: serializar todos los inputs, radios y checkboxes del documento
    function serializeForm() {
      const data = {};
      const fields = document.querySelectorAll("input, select, textarea");
      fields.forEach(el => {
        const name = el.name;
        if(!name) return;

        if (el.type === "radio") {
          if (el.checked) data[name] = el.value;
          else if (!(name in data)) data[name] = ""; // asegurar clave
        } else if (el.type === "checkbox") {
          if (el.checked) data[name] = el.value || "Si";
          else data[name] = data[name] || ""; // vacío si no marcado
        } else {
          data[name] = el.value || "";
        }
      });
      return data;
    }

    function toUrlEncoded(obj){
      return Object.keys(obj)
        .map(k => encodeURIComponent(k) + "=" + encodeURIComponent(obj[k] ?? ""))
        .join("&");
    }

    async function sendAndPrint(){
      const btn = document.getElementById("btnSubmit");
      const msg = document.getElementById("msg");
      try{
        btn.disabled = true;
        msg.textContent = "Enviando datos…";
        const payload = serializeForm();

        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: {"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
          body: toUrlEncoded(payload)
        });

        if(!res.ok){
          throw new Error("Respuesta no válida del servidor (" + res.status + ")");
        }

        // Opcional: verificar texto devuelto
        const text = await res.text();
        msg.innerHTML = `<span class="ok">¡Guardado! Abriendo impresión…</span>`;

        // Abrir diálogo de impresión
        window.print();

        // Mensaje final
        setTimeout(()=>{ msg.innerHTML = `<span class="ok">Envío completado.</span>`; }, 500);

      }catch(err){
        console.error(err);
        msg.innerHTML = `<span class="err">Error al enviar: ${err.message}</span>`;
      }finally{
        btn.disabled = false;
      }
    }

    document.getElementById("btnSubmit").addEventListener("click", (e)=>{
      e.preventDefault();
      sendAndPrint();
    });
  </script>
</body>
</html>
